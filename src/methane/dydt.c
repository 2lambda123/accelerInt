#include "header.h"
#include "chem_utils.h"
#include "rates.h"

#if defined(CONP)

void dydt (const Real t, const Real pres, const Real * y, Real * dy) {

  // mass-averaged density
  Real rho;
  rho = (y[1] / 2.01594) + (y[2] / 1.00797) + (y[3] / 15.9994) + (y[4] / 31.9988)
      + (y[5] / 17.00737) + (y[6] / 18.01534) + (y[7] / 33.00677) + (y[8] / 34.01474)
      + (y[9] / 12.01115) + (y[10] / 13.01912) + (y[11] / 14.02709) + (y[12] / 14.02709)
      + (y[13] / 15.03506) + (y[14] / 16.04303) + (y[15] / 28.01055) + (y[16] / 44.00995)
      + (y[17] / 29.01852) + (y[18] / 30.02649) + (y[19] / 31.03446) + (y[20] / 31.03446)
      + (y[21] / 32.04243) + (y[22] / 25.03027) + (y[23] / 26.03824) + (y[24] / 27.04621)
      + (y[25] / 28.05418) + (y[26] / 29.06215) + (y[27] / 30.07012) + (y[28] / 41.02967)
      + (y[29] / 42.03764) + (y[30] / 42.03764) + (y[31] / 14.0067) + (y[32] / 15.01467)
      + (y[33] / 16.02264) + (y[34] / 17.03061) + (y[35] / 29.02137) + (y[36] / 30.0061)
      + (y[37] / 46.0055) + (y[38] / 44.0128) + (y[39] / 31.01407) + (y[40] / 26.01785)
      + (y[41] / 27.02582) + (y[42] / 28.03379) + (y[43] / 41.03252) + (y[44] / 43.02522)
      + (y[45] / 43.02522) + (y[46] / 43.02522) + (y[47] / 42.01725) + (y[48] / 28.0134)
      + (y[49] / 39.948) + (y[50] / 43.08924) + (y[51] / 44.09721) + (y[52] / 43.04561)
      + (y[53] / 44.05358);
  rho = pres / (8.31451000e+07 * y[0] * rho);

  // species molar concentrations
  Real conc[53];
  conc[0] = rho * y[1] / 2.01594;
  conc[1] = rho * y[2] / 1.00797;
  conc[2] = rho * y[3] / 15.9994;
  conc[3] = rho * y[4] / 31.9988;
  conc[4] = rho * y[5] / 17.00737;
  conc[5] = rho * y[6] / 18.01534;
  conc[6] = rho * y[7] / 33.00677;
  conc[7] = rho * y[8] / 34.01474;
  conc[8] = rho * y[9] / 12.01115;
  conc[9] = rho * y[10] / 13.01912;
  conc[10] = rho * y[11] / 14.02709;
  conc[11] = rho * y[12] / 14.02709;
  conc[12] = rho * y[13] / 15.03506;
  conc[13] = rho * y[14] / 16.04303;
  conc[14] = rho * y[15] / 28.01055;
  conc[15] = rho * y[16] / 44.00995;
  conc[16] = rho * y[17] / 29.01852;
  conc[17] = rho * y[18] / 30.02649;
  conc[18] = rho * y[19] / 31.03446;
  conc[19] = rho * y[20] / 31.03446;
  conc[20] = rho * y[21] / 32.04243;
  conc[21] = rho * y[22] / 25.03027;
  conc[22] = rho * y[23] / 26.03824;
  conc[23] = rho * y[24] / 27.04621;
  conc[24] = rho * y[25] / 28.05418;
  conc[25] = rho * y[26] / 29.06215;
  conc[26] = rho * y[27] / 30.07012;
  conc[27] = rho * y[28] / 41.02967;
  conc[28] = rho * y[29] / 42.03764;
  conc[29] = rho * y[30] / 42.03764;
  conc[30] = rho * y[31] / 14.0067;
  conc[31] = rho * y[32] / 15.01467;
  conc[32] = rho * y[33] / 16.02264;
  conc[33] = rho * y[34] / 17.03061;
  conc[34] = rho * y[35] / 29.02137;
  conc[35] = rho * y[36] / 30.0061;
  conc[36] = rho * y[37] / 46.0055;
  conc[37] = rho * y[38] / 44.0128;
  conc[38] = rho * y[39] / 31.01407;
  conc[39] = rho * y[40] / 26.01785;
  conc[40] = rho * y[41] / 27.02582;
  conc[41] = rho * y[42] / 28.03379;
  conc[42] = rho * y[43] / 41.03252;
  conc[43] = rho * y[44] / 43.02522;
  conc[44] = rho * y[45] / 43.02522;
  conc[45] = rho * y[46] / 43.02522;
  conc[46] = rho * y[47] / 42.01725;
  conc[47] = rho * y[48] / 28.0134;
  conc[48] = rho * y[49] / 39.948;
  conc[49] = rho * y[50] / 43.08924;
  conc[50] = rho * y[51] / 44.09721;
  conc[51] = rho * y[52] / 43.04561;
  conc[52] = rho * y[53] / 44.05358;

  // local arrays holding reaction rates
  Real fwd_rates[325];
  Real rev_rates[309];
  eval_rxn_rates (y[0], conc, fwd_rates, rev_rates);

  // get pressure modifications to reaction rates
  Real pres_mod[41];
  get_rxn_pres_mod (y[0], pres, conc, pres_mod);

  // evaluate rate of change of species molar concentration
  eval_spec_rates (fwd_rates, rev_rates, pres_mod, &dy[1]);

  // local array holding constant pressure specific heat
  Real cp[53];
  eval_cp (y[0], cp);

  // constant pressure mass-average specific heat
  Real cp_avg = (cp[0] * y[1]) + (cp[1] * y[2]) + (cp[2] * y[3]) + (cp[3] * y[4])
              + (cp[4] * y[5]) + (cp[5] * y[6]) + (cp[6] * y[7]) + (cp[7] * y[8])
              + (cp[8] * y[9]) + (cp[9] * y[10]) + (cp[10] * y[11]) + (cp[11] * y[12])
              + (cp[12] * y[13]) + (cp[13] * y[14]) + (cp[14] * y[15]) + (cp[15] * y[16])
              + (cp[16] * y[17]) + (cp[17] * y[18]) + (cp[18] * y[19]) + (cp[19] * y[20])
              + (cp[20] * y[21]) + (cp[21] * y[22]) + (cp[22] * y[23]) + (cp[23] * y[24])
              + (cp[24] * y[25]) + (cp[25] * y[26]) + (cp[26] * y[27]) + (cp[27] * y[28])
              + (cp[28] * y[29]) + (cp[29] * y[30]) + (cp[30] * y[31]) + (cp[31] * y[32])
              + (cp[32] * y[33]) + (cp[33] * y[34]) + (cp[34] * y[35]) + (cp[35] * y[36])
              + (cp[36] * y[37]) + (cp[37] * y[38]) + (cp[38] * y[39]) + (cp[39] * y[40])
              + (cp[40] * y[41]) + (cp[41] * y[42]) + (cp[42] * y[43]) + (cp[43] * y[44])
              + (cp[44] * y[45]) + (cp[45] * y[46]) + (cp[46] * y[47]) + (cp[47] * y[48])
              + (cp[48] * y[49]) + (cp[49] * y[50]) + (cp[50] * y[51]) + (cp[51] * y[52])
              + (cp[52] * y[53]);

  // local array for species enthalpies
  Real h[53];
  eval_h (y[0], h);

  // rate of change of temperature
  dy[0] = (-1.0 / (rho * cp_avg)) * ( (dy[1] * h[0] * 2.01594) + (dy[2] * h[1] * 1.00797)
        + (dy[3] * h[2] * 15.9994) + (dy[4] * h[3] * 31.9988) + (dy[5] * h[4] * 17.00737)
        + (dy[6] * h[5] * 18.01534) + (dy[7] * h[6] * 33.00677) + (dy[8] * h[7] * 34.01474)
        + (dy[9] * h[8] * 12.01115) + (dy[10] * h[9] * 13.01912) + (dy[11] * h[10] * 14.02709)
        + (dy[12] * h[11] * 14.02709) + (dy[13] * h[12] * 15.03506) + (dy[14] * h[13] * 16.04303)
        + (dy[15] * h[14] * 28.01055) + (dy[16] * h[15] * 44.00995) + (dy[17] * h[16] * 29.01852)
        + (dy[18] * h[17] * 30.02649) + (dy[19] * h[18] * 31.03446) + (dy[20] * h[19] * 31.03446)
        + (dy[21] * h[20] * 32.04243) + (dy[22] * h[21] * 25.03027) + (dy[23] * h[22] * 26.03824)
        + (dy[24] * h[23] * 27.04621) + (dy[25] * h[24] * 28.05418) + (dy[26] * h[25] * 29.06215)
        + (dy[27] * h[26] * 30.07012) + (dy[28] * h[27] * 41.02967) + (dy[29] * h[28] * 42.03764)
        + (dy[30] * h[29] * 42.03764) + (dy[31] * h[30] * 14.0067) + (dy[32] * h[31] * 15.01467)
        + (dy[33] * h[32] * 16.02264) + (dy[34] * h[33] * 17.03061) + (dy[35] * h[34] * 29.02137)
        + (dy[36] * h[35] * 30.0061) + (dy[37] * h[36] * 46.0055) + (dy[38] * h[37] * 44.0128)
        + (dy[39] * h[38] * 31.01407) + (dy[40] * h[39] * 26.01785) + (dy[41] * h[40] * 27.02582)
        + (dy[42] * h[41] * 28.03379) + (dy[43] * h[42] * 41.03252) + (dy[44] * h[43] * 43.02522)
        + (dy[45] * h[44] * 43.02522) + (dy[46] * h[45] * 43.02522) + (dy[47] * h[46] * 42.01725)
        + (dy[48] * h[47] * 28.0134) + (dy[49] * h[48] * 39.948) + (dy[50] * h[49] * 43.08924)
        + (dy[51] * h[50] * 44.09721) + (dy[52] * h[51] * 43.04561) + (dy[53] * h[52] * 44.05358) );

  // calculate rate of change of species mass fractions
  dy[1] *= (2.01594 / rho);
  dy[2] *= (1.00797 / rho);
  dy[3] *= (15.9994 / rho);
  dy[4] *= (31.9988 / rho);
  dy[5] *= (17.00737 / rho);
  dy[6] *= (18.01534 / rho);
  dy[7] *= (33.00677 / rho);
  dy[8] *= (34.01474 / rho);
  dy[9] *= (12.01115 / rho);
  dy[10] *= (13.01912 / rho);
  dy[11] *= (14.02709 / rho);
  dy[12] *= (14.02709 / rho);
  dy[13] *= (15.03506 / rho);
  dy[14] *= (16.04303 / rho);
  dy[15] *= (28.01055 / rho);
  dy[16] *= (44.00995 / rho);
  dy[17] *= (29.01852 / rho);
  dy[18] *= (30.02649 / rho);
  dy[19] *= (31.03446 / rho);
  dy[20] *= (31.03446 / rho);
  dy[21] *= (32.04243 / rho);
  dy[22] *= (25.03027 / rho);
  dy[23] *= (26.03824 / rho);
  dy[24] *= (27.04621 / rho);
  dy[25] *= (28.05418 / rho);
  dy[26] *= (29.06215 / rho);
  dy[27] *= (30.07012 / rho);
  dy[28] *= (41.02967 / rho);
  dy[29] *= (42.03764 / rho);
  dy[30] *= (42.03764 / rho);
  dy[31] *= (14.0067 / rho);
  dy[32] *= (15.01467 / rho);
  dy[33] *= (16.02264 / rho);
  dy[34] *= (17.03061 / rho);
  dy[35] *= (29.02137 / rho);
  dy[36] *= (30.0061 / rho);
  dy[37] *= (46.0055 / rho);
  dy[38] *= (44.0128 / rho);
  dy[39] *= (31.01407 / rho);
  dy[40] *= (26.01785 / rho);
  dy[41] *= (27.02582 / rho);
  dy[42] *= (28.03379 / rho);
  dy[43] *= (41.03252 / rho);
  dy[44] *= (43.02522 / rho);
  dy[45] *= (43.02522 / rho);
  dy[46] *= (43.02522 / rho);
  dy[47] *= (42.01725 / rho);
  dy[48] *= (28.0134 / rho);
  dy[49] *= (39.948 / rho);
  dy[50] *= (43.08924 / rho);
  dy[51] *= (44.09721 / rho);
  dy[52] *= (43.04561 / rho);
  dy[53] *= (44.05358 / rho);

} // end dydt

#elif defined(CONV)

void dydt (const Real t, const Real rho, const Real * y, Real * dy) {

  // pressure
  Real pres;
  pres = (y[1] / 2.01594) + (y[2] / 1.00797) + (y[3] / 15.9994) + (y[4] / 31.9988)
       + (y[5] / 17.00737) + (y[6] / 18.01534) + (y[7] / 33.00677) + (y[8] / 34.01474)
       + (y[9] / 12.01115) + (y[10] / 13.01912) + (y[11] / 14.02709) + (y[12] / 14.02709)
       + (y[13] / 15.03506) + (y[14] / 16.04303) + (y[15] / 28.01055) + (y[16] / 44.00995)
       + (y[17] / 29.01852) + (y[18] / 30.02649) + (y[19] / 31.03446) + (y[20] / 31.03446)
       + (y[21] / 32.04243) + (y[22] / 25.03027) + (y[23] / 26.03824) + (y[24] / 27.04621)
       + (y[25] / 28.05418) + (y[26] / 29.06215) + (y[27] / 30.07012) + (y[28] / 41.02967)
       + (y[29] / 42.03764) + (y[30] / 42.03764) + (y[31] / 14.0067) + (y[32] / 15.01467)
       + (y[33] / 16.02264) + (y[34] / 17.03061) + (y[35] / 29.02137) + (y[36] / 30.0061)
       + (y[37] / 46.0055) + (y[38] / 44.0128) + (y[39] / 31.01407) + (y[40] / 26.01785)
       + (y[41] / 27.02582) + (y[42] / 28.03379) + (y[43] / 41.03252) + (y[44] / 43.02522)
       + (y[45] / 43.02522) + (y[46] / 43.02522) + (y[47] / 42.01725) + (y[48] / 28.0134)
       + (y[49] / 39.948) + (y[50] / 43.08924) + (y[51] / 44.09721) + (y[52] / 43.04561)
       + (y[53] / 44.05358);
  pres = rho * 8.31451000e+07 * y[0] * pres;

  // species molar concentrations
  Real conc[53];
  conc[0] = rho * y[1] / 2.01594;
  conc[1] = rho * y[2] / 1.00797;
  conc[2] = rho * y[3] / 15.9994;
  conc[3] = rho * y[4] / 31.9988;
  conc[4] = rho * y[5] / 17.00737;
  conc[5] = rho * y[6] / 18.01534;
  conc[6] = rho * y[7] / 33.00677;
  conc[7] = rho * y[8] / 34.01474;
  conc[8] = rho * y[9] / 12.01115;
  conc[9] = rho * y[10] / 13.01912;
  conc[10] = rho * y[11] / 14.02709;
  conc[11] = rho * y[12] / 14.02709;
  conc[12] = rho * y[13] / 15.03506;
  conc[13] = rho * y[14] / 16.04303;
  conc[14] = rho * y[15] / 28.01055;
  conc[15] = rho * y[16] / 44.00995;
  conc[16] = rho * y[17] / 29.01852;
  conc[17] = rho * y[18] / 30.02649;
  conc[18] = rho * y[19] / 31.03446;
  conc[19] = rho * y[20] / 31.03446;
  conc[20] = rho * y[21] / 32.04243;
  conc[21] = rho * y[22] / 25.03027;
  conc[22] = rho * y[23] / 26.03824;
  conc[23] = rho * y[24] / 27.04621;
  conc[24] = rho * y[25] / 28.05418;
  conc[25] = rho * y[26] / 29.06215;
  conc[26] = rho * y[27] / 30.07012;
  conc[27] = rho * y[28] / 41.02967;
  conc[28] = rho * y[29] / 42.03764;
  conc[29] = rho * y[30] / 42.03764;
  conc[30] = rho * y[31] / 14.0067;
  conc[31] = rho * y[32] / 15.01467;
  conc[32] = rho * y[33] / 16.02264;
  conc[33] = rho * y[34] / 17.03061;
  conc[34] = rho * y[35] / 29.02137;
  conc[35] = rho * y[36] / 30.0061;
  conc[36] = rho * y[37] / 46.0055;
  conc[37] = rho * y[38] / 44.0128;
  conc[38] = rho * y[39] / 31.01407;
  conc[39] = rho * y[40] / 26.01785;
  conc[40] = rho * y[41] / 27.02582;
  conc[41] = rho * y[42] / 28.03379;
  conc[42] = rho * y[43] / 41.03252;
  conc[43] = rho * y[44] / 43.02522;
  conc[44] = rho * y[45] / 43.02522;
  conc[45] = rho * y[46] / 43.02522;
  conc[46] = rho * y[47] / 42.01725;
  conc[47] = rho * y[48] / 28.0134;
  conc[48] = rho * y[49] / 39.948;
  conc[49] = rho * y[50] / 43.08924;
  conc[50] = rho * y[51] / 44.09721;
  conc[51] = rho * y[52] / 43.04561;
  conc[52] = rho * y[53] / 44.05358;

  // local array holding reaction rates
  Real rates[325];
  eval_rxn_rates (y[0], pres, conc, rates);

  // evaluate rate of change of species molar concentration
  eval_spec_rates (rates, &dy[1]);

  // local array holding constant volume specific heat
  Real cv[53];
  eval_cv (y[0], cv);

  // constant volume mass-average specific heat
  Real cv_avg = (cv[0] * y[1]) + (cv[1] * y[2]) + (cv[2] * y[3]) + (cv[3] * y[4])
              + (cv[4] * y[5]) + (cv[5] * y[6]) + (cv[6] * y[7]) + (cv[7] * y[8])
              + (cv[8] * y[9]) + (cv[9] * y[10]) + (cv[10] * y[11]) + (cv[11] * y[12])
              + (cv[12] * y[13]) + (cv[13] * y[14]) + (cv[14] * y[15]) + (cv[15] * y[16])
              + (cv[16] * y[17]) + (cv[17] * y[18]) + (cv[18] * y[19]) + (cv[19] * y[20])
              + (cv[20] * y[21]) + (cv[21] * y[22]) + (cv[22] * y[23]) + (cv[23] * y[24])
              + (cv[24] * y[25]) + (cv[25] * y[26]) + (cv[26] * y[27]) + (cv[27] * y[28])
              + (cv[28] * y[29]) + (cv[29] * y[30]) + (cv[30] * y[31]) + (cv[31] * y[32])
              + (cv[32] * y[33]) + (cv[33] * y[34]) + (cv[34] * y[35]) + (cv[35] * y[36])
              + (cv[36] * y[37]) + (cv[37] * y[38]) + (cv[38] * y[39]) + (cv[39] * y[40])
              + (cv[40] * y[41]) + (cv[41] * y[42]) + (cv[42] * y[43]) + (cv[43] * y[44])
              + (cv[44] * y[45]) + (cv[45] * y[46]) + (cv[46] * y[47]) + (cv[47] * y[48])
              + (cv[48] * y[49]) + (cv[49] * y[50]) + (cv[50] * y[51]) + (cv[51] * y[52])
              + (cv[52] * y[53]);

  // local array for species internal energies
  Real u[53];
  eval_u (y[0], u);

  // rate of change of temperature
  dy[0] = (-1.0 / (rho * cv_avg)) * ( (dy[1] * u[0] * 2.01594) + (dy[2] * u[1] * 1.00797)
        + (dy[3] * u[2] * 15.9994) + (dy[4] * u[3] * 31.9988) + (dy[5] * u[4] * 17.00737)
        + (dy[6] * u[5] * 18.01534) + (dy[7] * u[6] * 33.00677) + (dy[8] * u[7] * 34.01474)
        + (dy[9] * u[8] * 12.01115) + (dy[10] * u[9] * 13.01912) + (dy[11] * u[10] * 14.02709)
        + (dy[12] * u[11] * 14.02709) + (dy[13] * u[12] * 15.03506) + (dy[14] * u[13] * 16.04303)
        + (dy[15] * u[14] * 28.01055) + (dy[16] * u[15] * 44.00995) + (dy[17] * u[16] * 29.01852)
        + (dy[18] * u[17] * 30.02649) + (dy[19] * u[18] * 31.03446) + (dy[20] * u[19] * 31.03446)
        + (dy[21] * u[20] * 32.04243) + (dy[22] * u[21] * 25.03027) + (dy[23] * u[22] * 26.03824)
        + (dy[24] * u[23] * 27.04621) + (dy[25] * u[24] * 28.05418) + (dy[26] * u[25] * 29.06215)
        + (dy[27] * u[26] * 30.07012) + (dy[28] * u[27] * 41.02967) + (dy[29] * u[28] * 42.03764)
        + (dy[30] * u[29] * 42.03764) + (dy[31] * u[30] * 14.0067) + (dy[32] * u[31] * 15.01467)
        + (dy[33] * u[32] * 16.02264) + (dy[34] * u[33] * 17.03061) + (dy[35] * u[34] * 29.02137)
        + (dy[36] * u[35] * 30.0061) + (dy[37] * u[36] * 46.0055) + (dy[38] * u[37] * 44.0128)
        + (dy[39] * u[38] * 31.01407) + (dy[40] * u[39] * 26.01785) + (dy[41] * u[40] * 27.02582)
        + (dy[42] * u[41] * 28.03379) + (dy[43] * u[42] * 41.03252) + (dy[44] * u[43] * 43.02522)
        + (dy[45] * u[44] * 43.02522) + (dy[46] * u[45] * 43.02522) + (dy[47] * u[46] * 42.01725)
        + (dy[48] * u[47] * 28.0134) + (dy[49] * u[48] * 39.948) + (dy[50] * u[49] * 43.08924)
        + (dy[51] * u[50] * 44.09721) + (dy[52] * u[51] * 43.04561) + (dy[53] * u[52] * 44.05358) );

  // calculate rate of change of species mass fractions
  dy[1] *= (2.01594 / rho);
  dy[2] *= (1.00797 / rho);
  dy[3] *= (15.9994 / rho);
  dy[4] *= (31.9988 / rho);
  dy[5] *= (17.00737 / rho);
  dy[6] *= (18.01534 / rho);
  dy[7] *= (33.00677 / rho);
  dy[8] *= (34.01474 / rho);
  dy[9] *= (12.01115 / rho);
  dy[10] *= (13.01912 / rho);
  dy[11] *= (14.02709 / rho);
  dy[12] *= (14.02709 / rho);
  dy[13] *= (15.03506 / rho);
  dy[14] *= (16.04303 / rho);
  dy[15] *= (28.01055 / rho);
  dy[16] *= (44.00995 / rho);
  dy[17] *= (29.01852 / rho);
  dy[18] *= (30.02649 / rho);
  dy[19] *= (31.03446 / rho);
  dy[20] *= (31.03446 / rho);
  dy[21] *= (32.04243 / rho);
  dy[22] *= (25.03027 / rho);
  dy[23] *= (26.03824 / rho);
  dy[24] *= (27.04621 / rho);
  dy[25] *= (28.05418 / rho);
  dy[26] *= (29.06215 / rho);
  dy[27] *= (30.07012 / rho);
  dy[28] *= (41.02967 / rho);
  dy[29] *= (42.03764 / rho);
  dy[30] *= (42.03764 / rho);
  dy[31] *= (14.0067 / rho);
  dy[32] *= (15.01467 / rho);
  dy[33] *= (16.02264 / rho);
  dy[34] *= (17.03061 / rho);
  dy[35] *= (29.02137 / rho);
  dy[36] *= (30.0061 / rho);
  dy[37] *= (46.0055 / rho);
  dy[38] *= (44.0128 / rho);
  dy[39] *= (31.01407 / rho);
  dy[40] *= (26.01785 / rho);
  dy[41] *= (27.02582 / rho);
  dy[42] *= (28.03379 / rho);
  dy[43] *= (41.03252 / rho);
  dy[44] *= (43.02522 / rho);
  dy[45] *= (43.02522 / rho);
  dy[46] *= (43.02522 / rho);
  dy[47] *= (42.01725 / rho);
  dy[48] *= (28.0134 / rho);
  dy[49] *= (39.948 / rho);
  dy[50] *= (43.08924 / rho);
  dy[51] *= (44.09721 / rho);
  dy[52] *= (43.04561 / rho);
  dy[53] *= (44.05358 / rho);

} // end dydt

#endif
